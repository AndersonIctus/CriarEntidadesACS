CREATE TABLE public.ITENS_COMPRA (
    ID					INTEGER NOT NULL,
    NUMERO              SMALLINT NOT NULL,
    ID_COMPRA           INTEGER NOT NULL,
    ID_PRODUTO_EMPRESA  INTEGER NOT NULL,
	COD_CEST            VARCHAR(7),
	OBSERVACAO          TEXT,
    CANCELADO           CHAR(1) NOT NULL,
    ALTERA_CUSTO        CHAR(1) NOT NULL,
    TIPO_TRIBUTACAO     CHAR(1), -- (Com (C)rédito, (I)sento ou (O)utros)
    DT_VALIDADE         DATE NOT NULL,
    OFFSET_DT_VALIDADE  VARCHAR(6) NOT NULL,
    UNID_CAIXA          SMALLINT,

	SALDO_INICIAL       NUMERIC(12,3) NOT NULL,
    SALDO_FINAL         NUMERIC(12,3) NOT NULL,

	CONSTRAINT UN_ITENS_COMPRA UNIQUE (ID_COMPRA, NUMERO),
	CONSTRAINT PK_ITENS_COMPRA PRIMARY KEY (ID)
);

CREATE INDEX FK_ITENS_COMPRA_COMPRA ON ITENS_COMPRA (ID_COMPRA);

-- SCRIPT FOREIGN KEYS DA TABELA ITENS_COMPRA
ALTER TABLE ONLY public.ITENS_COMPRA
    ADD CONSTRAINT FK_PRODUTOS_EMPRESA_ITENS_COMPRA FOREIGN KEY (ID_PRODUTO_EMPRESA) REFERENCES public.PRODUTOS_EMPRESA (ID); -- É por empresa;
ALTER TABLE ONLY public.ITENS_COMPRA
    ADD CONSTRAINT FK_COMPRAS_ITENS_COMPRA FOREIGN KEY (ID_COMPRA) REFERENCES public.COMPRAS (ID); -- É por empresa;
